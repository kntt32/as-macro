import core;
import cmp;
import slice;
import str;
import option;

pub template Display(Formatter) {
    pub as display(inout self: $(Formatter)@mem, in object: Str@mem) {
        self.write(object);
    };

    pub as display(inout self: $(Formatter)@mem, in object: i64@reg+mem+imm) {
        let object_mem: i64@stack = object;
        let object_rax: i64@rax = object_mem;
        let str: Str@stack;
        let flag: bool@r8;

        if(flag.lt(object_rax, 0)) {
            str.from("-");
            self.write(str);
            object_rax.neg();
        };

        if(flag.eq(object_rax, 0)) {
            str.from("0");
            self.write(str);
        }else {
            let buffer: [char; 32]@stack;
            buffer[31] = '\0';
            let buffer_index: i64@r9 = 31;
            let buffer_ptr: *char@r10;
        
            let remainder: i64@rdx;
            let divisor: i64@r11 = 10;
        
            while(flag.neq(object_rax, 0)) {
                remainder = 0;
                object_rax.div(remainder, divisor);
                let remainder_i8: i8@r12 = remainder;

                buffer_index -= 1;
                buffer_ptr =& buffer;
                buffer_ptr += buffer_index;
                *buffer_ptr = '0';
                *buffer_ptr += remainder_i8;
            };

            buffer_ptr =& buffer;
            buffer_ptr += buffer_index;
            
            str.from(buffer_ptr);
            self.write(str);
        }
    };
};

