import core;
import core.mem;
import std.syscall;
import std.alloc;
import std.io;
import std.io.print;

pub extern fn main();

pub static STD_ALLOC: Alloc;
pub static STD_STDOUT: Io;
pub static STD_STDERR: Io;

pub fn _start() {
    STD_ALLOC.new();
    STD_STDOUT.new(STDOUT);
    STD_STDERR.new(STDERR);

    main();

    STD_STDERR.drop();
    STD_STDOUT.drop();
    STD_ALLOC.drop();
    let status: i32@rdi;
    status = 0;
    exit(status);
};

pub fn panic_handler(msg: *char@rdi) {
    let str: Str@stack;
    eprintf(str.from("paniced: "));
    eprintfln(str.from(msg));

    let code: i32@rdi = -1;
    exit(code);
};


